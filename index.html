<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãŠã—ã‚ƒã¹ã‚Šä¼š å…¨æ–‡æ¤œç´¢</title>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@7"></script>
<style>
body { font-family: sans-serif; max-width: 700px; margin: 20px auto; line-height: 1.6; }
input { width: 100%; padding: 8px; font-size: 1em; margin-bottom: 1em; }
.result { margin-bottom: 1.5em; border-bottom: 1px solid #ddd; padding-bottom: .5em; }
.snippet { background: #f5f5f5; padding: .4em; border-radius: .4em; display: block; margin-top: .3em; }
</style>
</head>
<body>

<h1>å±±æœ¬å¤ªéƒã¨ãŠã—ã‚ƒã¹ã‚Šä¼š å…¨æ–‡æ¤œç´¢</h1>
<input type="text" id="query" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šæ¶ˆè²»ç¨ã€ç”Ÿæ´»ä¿è­·ãªã©ï¼‰">
<div id="results"></div>

<script>
const files = [
  "talks/2025-09-03-wakkanai.html",
  "talks/2025-09-18-obihiro.html",
  // ğŸ‘† ã“ã“ã«è¿½åŠ ã—ã¦ã„ãï¼ˆä¾‹ï¼š"talks/2025-09-25-sapporo.html",ï¼‰
];

let data = [];

// å„ãƒšãƒ¼ã‚¸ã‚’å–å¾—ã—ã¦ Fuse ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã‚‹
Promise.all(
  files.map(async file => {
    const res = await fetch(file);
    const text = await res.text();
    data.push({ title: file.split('/')[1].replace('.html',''), text, url: file });
  })
).then(() => {
  const fuse = new Fuse(data, {
    includeScore: true,
    keys: ['text'],
    threshold: 0.3
  });

  document.getElementById('query').addEventListener('input', e => {
    const q = e.target.value.trim();
    const resultDiv = document.getElementById('results');
    resultDiv.innerHTML = '';
    if (!q) return;

    const results = fuse.search(q);
    results.forEach(res => {
      const text = res.item.text;
      const re = new RegExp(q, 'g');
      const matches = [...text.matchAll(re)];
      matches.forEach(m => {
        const i = m.index;
        const snippet = text.slice(Math.max(0, i - 60), i + q.length + 60);
        const safeSnippet = snippet.replace(/</g,"&lt;").replace(/>/g,"&gt;");
        const highlighted = safeSnippet.replace(new RegExp(q,'g'), `<mark>${q}</mark>`);
        resultDiv.innerHTML += `
          <div class="result">
            <strong>${res.item.title}</strong>
            <a href="${res.item.url}" target="_blank">ï¼ˆå…¨æ–‡ï¼‰</a>
            <span class="snippet">â€¦${highlighted}â€¦</span>
          </div>`;
      });
    });
  });
});
</script>

</body>
</html>
